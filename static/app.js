const scanBtn = document.getElementById("scanBtn");
const result = document.getElementById("result");
const statusText = document.getElementById("statusText");
const riskText = document.getElementById("riskText");
const downloadBtn = document.getElementById("downloadBtn");

let lastScanData = null;

scanBtn.addEventListener("click", () => {
  const url = document.getElementById("urlInput").value.trim();

  if (!url) {
    alert("Please enter a URL");
    return;
  }

  result.classList.remove("hidden");
  result.classList.add("fade-in");

  const risk = Math.floor(Math.random() * 60) + 10;

  const indicators = [
    "Suspicious URL structure",
    "Recently registered domain",
    "Unusual redirection behavior",
    "No verified SSL issuer",
    "Similarity to known phishing domains"
  ];

  const foundIndicators = indicators
    .sort(() => 0.5 - Math.random())
    .slice(0, Math.floor(Math.random() * 3) + 1);

  if (risk > 45) {
    statusText.innerText = "⚠️ SUSPICIOUS";
    statusText.style.color = "#ff4d4d";
  } else {
    statusText.innerText = "✅ SAFE";
    statusText.style.color = "#00e0c6";
  }

  riskText.innerText = `Risk Score: ${risk}`;

  lastScanData = {
    url,
    risk,
    status: risk > 45 ? "SUSPICIOUS" : "SAFE",
    indicators: foundIndicators
  };
});

downloadBtn.addEventListener("click", () => {
  if (!lastScanData) return;

  const content = `
PHISHSHIELD SECURITY REPORT
===========================

Scanned URL:
${lastScanData.url}

Overall Status:
${lastScanData.status}

Risk Score:
${lastScanData.risk}

Suspicious Indicators Detected:
${lastScanData.indicators.map(i => `- ${i}`).join("\n")}

--------------------------------
Generated by PhishShield
Cyber Threat Detection System
`;

  const blob = new Blob([content], { type: "application/pdf" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "phishshield_report.pdf";
  link.click();
});

// Accordion animation
document.querySelectorAll(".accordion-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const content = btn.nextElementSibling;
    content.classList.toggle("open");
  });
});

// Smooth scroll
document.documentElement.style.scrollBehavior = "smooth";

// Theme toggle
document.getElementById("themeToggle").addEventListener("click", () => {
  document.body.classList.toggle("dark");
});
